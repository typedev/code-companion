# v0.2.1 Plan: Viewer Improvements

## Goal

Enhance the session viewer with markdown rendering, code highlighting, and expandable tool call content.

## Checkpoints

### Checkpoint 1: Markdown support
- [x] Add markdown parsing library or use Pango markup
- [x] Render headings, bold, italic, inline code
- [x] Render code blocks with syntax highlighting (GtkSourceView)
- [x] Render lists and blockquotes

### Checkpoint 2: Code highlighting in tool calls
- [x] Add GtkSourceView for code display
- [x] Detect language from file extension
- [x] Show Read tool output with syntax highlighting
- [x] Show Edit tool with old/new diff highlighting

### Checkpoint 3: Expandable tool call content
- [x] Make ToolCallCard expandable (click to show content)
- [x] Show file contents for Read operations
- [x] Show diff for Edit operations (old_string → new_string)
- [x] Show command output for Bash operations
- [x] Truncate long outputs with indicator

### Checkpoint 4: Visual polish
- [x] Improve message card styling
- [x] Add error styling for failed tool calls
- [x] Better spacing and typography

## Dependencies

```toml
# May need to add to pyproject.toml if using external markdown parser
# Or use GtkSourceView's built-in capabilities
```

## File Changes

```
src/
├── widgets/
│   ├── tool_call_card.py  # Extend with expandable content
│   ├── code_view.py       # NEW: GtkSourceView wrapper
│   ├── markdown_view.py   # NEW: Markdown rendering widget
│   └── message_row.py     # Use markdown_view for text content
```

## Progress

- Started: 2025-12-11
- Current checkpoint: 4 (all complete)
- Status: DONE

### Notes

Implemented:
- `MarkdownView`: Parses markdown with code blocks, headings, lists, bold/italic
- `CodeView`: GtkSourceView wrapper with syntax highlighting by file extension
- `DiffView`: Shows old/new text for Edit operations
- `ToolCallCard`: Expandable cards with content for Read, Edit, Write, Bash, Grep, Glob
- Tool outputs stored in ContentBlock and passed through to widgets
